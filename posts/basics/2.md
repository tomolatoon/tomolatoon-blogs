# 変数と式 | 図形の描画
今回は変数という機能を学んだ上で、Siv3Dで図形を描画してみましょう。その前に前提知識を軽く話します。

## 値
C++における値は、例えば

```cpp
// 整数
0
27
-334

// 小数
3.14

// 文字（Siv3Dでは先頭に U をつけます）
U'c'

// 文字列（Siv3Dでは先頭に U をつけます）
U"str"
```

などがあります。整数や小数、文字や文字列も、C++の値です。（厳密には「値」ではなく「1次式」だったりしますが、一般的に「値」と呼ぶので気にしないでいきます。）

## 式
C++の式は、分類を考えていくと超複雑なんですが、基本的なところは算数と似ています。式は、**値と演算子が組み合わさって構成**されていて、**計算されると値になる**と考えておきましょう。ただし、C++の計算され方には注意がいくつかあります。

### 整数同士の計算
C++では、**整数同士の計算は整数に**なります。例を見てみましょう。

```cpp
3 + 4  // 足し算 7
3 - 4  // 引き算 -1
3 * 4  // 掛け算 12
3 / 4  // 割り算 0
3 % 4  // 余り算 3
```

`3 / 4`が`0`になりました。整数同士の計算結果が算数で小数になるときは、**小数点以下を見なかったことにします**。そのため、`3 / 4`は算数だと`0.75`になりますが、`.75`を見なかったことにして、`0`になります。

そして、`-3 / 4`の場合は、算数で`-0.75`となり、やはり`.75`を見なかったことにして、`0`になります。このように、**整数同士の計算結果は「0方向への丸め」という丸め（変換）が行われます**。

## 文
C++のプログラムは、文がたくさん並べられる事によって成り立っています。文はいくつか種類がありますが、例えば「式文」や「空文」などがあります。多くの文は`;`で終わります。

### 式文
式文は、先程紹介した「式」に「`;`」（セミコロン）をつけたものです。つまり、式そのものはコードにそのまま書くとコンパイルエラーになってしまいますが、「`;`」をつければ「文」の仲間になるためコンパイルエラーではなくなるわけです。例えば

```cpp
0;
1 + 1;
1 + 1 + 1;
```

などがすべて式文です。（値文は無いです！）式に「`;`」がついているのがわかると思います。

### 空文
空文は、ただ単に「`;`」だけがある文のことです。つまり、何も実行しないし、意味もない文です。空文があるおかげで、セミコロンを過剰にコードに書く分にはコンパイルエラーになりません。

```cpp
;
;;;
;;;;;;;;;;;
```

これは問題なくコンパイル出来ます。

## Siv3Dのコードの基本
Siv3Dでは、次のコードを基本とします。

```cpp
#include <Siv3D.hpp>

void Main()
{
    while(System::Update())
    {

    }
}
```

### Siv3D.hpp

```cpp
#include <Siv3D.hpp>
```

この行は、Siv3Dの機能を取り込むために書きます。`Siv3D.hpp`というファイルが、Siv3Dをインストールしたときに用意されているので、そのファイルを読み込んで貼り付けている形になります。（なお、`Siv3D.hpp`がある場所は、Visual Studioのプロジェクトの中に入っています。）

### Main関数

```cpp
void Main()
{

}

// こうやって呼び出せるようになっている
Main();
```

この部分を、`Main`関数といいます。関数は、簡単に言うと、複数の文をまとめて1つの式にする機能です。つまり、処理のかたまりを表します。`Main`関数は、Siv3Dの内部から使用されます。

### メインループ

```cpp
while(System::Update())
{

}
```

`Main`関数の中にある、この部分はメインループと呼びます。この部分はSiv3Dで1フレームごとに一回中身の部分にあたる`{}`波括弧の中に書いてある文が実行されます。

普通のディスプレイは1秒間に60回更新されて、Siv3Dもそれに合わせて60fpsになるので、メインループの中身も1秒間に60回実行されることが普通です。ただし、必ず1秒間に60回とも限らないので、それを前提にしたコードは書かないようにしましょう。

### Siv3Dでの文字の出力
Siv3Dでは`Print`でウィンドウ上に、`Console`で新しい黒いウィンドウ（これをコンソールと言います）上に、対応している値を文字列として表示することが出来ます。表示する値を渡すときには、「`<<`」左シフト演算子を使います。イメージとしては、流し込んでいる感じです。

```cpp
Print << "39 → 27";
Print << 3939;
```

Siv3Dのウィンドウの左上に文字列が表示されたでしょう。なお`Print`は、一度文で使用すると、その後勝手に改行を入れてくれます。

## 変数って何？
変数は、プログラムを実行中に値を保存する機能です。一般的に変数は「値を入れることが出来る箱」と例えられます。例を見てみましょう。

参考：[変数 (variable)とは｜「分かりそう」で「分からない」でも「分かった」気になれるIT用語辞典](https://wa3.i-3-i.info/word1603.html)

```cpp
// 宣言 + 初期化
int32 a = 1;

Print << a;

// 代入
a = 2;

Print << a;
```

### 名前
変数に関わらず、プログラミングでは名前を付けることが結構あります。C++では、名前に使える文字が結構制限されていて、

```
A B C D E F G H I J K L M N O P Q R S T U V W X Y Z
a b c d e f g h i j k l m n o p q r s t u v w x y z
0 1 2 3 4 5 6 7 8 9 _
```

アルファベットと、数字、アンダーバーだけが使えます。更に制限があって、

- 数字から始めてはいけない
    - コンパイルエラーになる
    - 数字との区別がつかないから
    - ok a
    - ng 0a
- ダブルスコア（アンダーバー2連続）を含んではいけない
    - コンパイルエラー「には」ならない
    - ok a_b
    - ng a__b
- アンダーバーと大文字アルファベットから始めてはいけない
    - コンパイルエラー「には」ならない
    - この名前は、コンパイルをするプログラムの「コンパイラー」を作るときに使っていて、衝突するかもしれない
    - ok _a
    - ng _A

### 名前の付け方
名前の付け方の原則は、英単語を並べて作ります。英単語の並べ方はいくつかあって、C++では

- camelCase
    - 単語の先頭文字を大文字にして、くっつける。ただし、先頭は小文字
- PascalCase
    - Siv3Dの付け方
    - 単語の先頭文字を大文字にして、くっつける。ただし、先頭も大文字
- snake_case
    - C++の標準的な付け方
    - 単語は全部小文字で、くっつけるときにアンダーバーをつける

が主に使われていて、どれかを統一して使うのがいいでしょうね。

### 型
型は、変数の宣言のときに一番最初に書くやつです。

```cpp
int32   // これ
i
= 0
;
```

変数の型は、その変数が扱う値の範囲を表していたり、その変数の扱える値の性質を表していたりします。また、変数の型は大きく2つに分けられ、

- 組み込み型
    - 整数
    - 小数
    - etc...
- ユーザー定義型
    - 文字列
    - 構造体/クラス
    - etc...

などのようになっています（かなり大雑把）。

#### 組み込み型
組み込み型は、C++の言語機能に組み込まれているプリミティブ（原始的）な型で、整数や小数などを扱う基本的な型がここに含まれます。Siv3Dでは組み込み型の別名が用意されていることもあり、C++標準とは少し使う名前が異なります。

#### Siv3Dで使用する基本的な型
まず整数ですが、整数は以下のような型を使います。ただし、扱える値の範囲があって、

- `int8`
    - 8bitの符号付き整数
    - `-128` ～ `127`
    - `-2^(8-1)` ～ `2^(8-1)-1`
- `int16`
    - 16bitの符号付き整数
    - `-32,768` ～ `32,767`
    - `-2^(16-1)` ～ `2^(16-1)-1`
- `int32`
    - 32bitの符号付き整数
    - `-2,147,483,648` ～ `2,147,483,647`
    - `-2^(32-1)` ～ `2^(32-1)-1`
- `int64`
    - 64bitの符号付き整数
    - `-9,223,372,036,854,775,808` ～ `9,223,372,036,854,775,807`
    - `-2^(64-1)` ～ `2^(64-1)-1`
- `uint8`
    - 8bitの符号無し整数
    - `0` ～ `255`
    - `0` ～ `2^8-1`
- `uint16`
    - 16bitの符号無し整数
    - `0` ～ `65,535`
    - `0` ～ `2^16-1`
- `uint32`
    - 32bitの符号無し整数
    - `-2,147,483,648` ～ `2,147,483,647`
    - `0` ～ `2^32-1`
- `uint64`
    - 64bitの符号無し整数
    - `0` ～ `4,294,967,295`
    - `0` ～ `2^64-1`

このようになっています。最後についている整数が、保存するのに使う2進法の桁数を表していると考えてください。なお、通常は`int32`を用いるのがいいでしょう。

小数は誤差が出る代わりに、非常に大きな値や小さな値が扱えて、

- `float`
    - 単精度浮動小数点数型（Binary32）
    - Unityは通常こちらを使う
- `double`
    - 倍精度浮動小数点数型（Binary64）
    - Siv3DやC++は通常こちらを使う

を主に使います。とりあえず`double`を使えば大丈夫です。

文字列は、

- `String`
    - Siv3Dの文字列は1つに統一されています
    - `U""`や`U""s`と書いている文字列を代入する事ができます
    - UnicodeかつUTF-32

を使います。C++標準には複数存在しますが、Siv3Dでは文字列の型はこれを使っていれば間違いありません。

### 初期化
変数の宣言のときに、値も設定するには、初期化を用います。

```cpp
int32
i
= 0  // ここ
;
```

初期化もC++ではとても複雑ですが、見た目的には4つあります。

```cpp
// 1
= 値

// 2
( 値 )

// 3
{ 値 }

// 4
= { 値 }
```

細かいことを気にしなければ、これら4つは同じように使えることが出来ます。

### 値を作ったり、型を変えたり
型名と初期化の「2」か「3」を使うと、その型名の値を作れます。場合によっては「関数形式のキャスト」と呼ぶこともあります。

```cpp
int32(1);
int32{1};
```

また、型名を丸括弧でくくって、値の前に置いて置く場合は「型キャスト」と呼びます。

```cpp
(int32)0;
```

## Siv3Dで図形を描く
Siv3Dでは図形を表す型があるので、その型の変数を作成して、その変数に`.`と`draw()`をつけると、画面にその図形を描画することが出来ます。

### 円
円は、`Circle`という型を使います。コンマ区切りで、中心の座標と半径をピクセル単位で指定して変数を作ります。

```cpp
while (System::Update())
{
    // Circle は円を表す型
    // Vec2   は座標を表す型
	// 中心座標 (400, 300), 半径 20 の円を描く
	Circle{ Vec2{400, 300}, 20 }.draw();
}
```

#### 色
色は、名前がつけられている色を選ぶか、自分で数値を指定（RGBまたはHSV）して値を作り、それを`draw()`に渡すことで指定できます。

```cpp
while (System::Update())
{
    // Circle は円を表す型
    // Vec2   は座標を表す型
	// 中心座標 (400, 300), 半径 20 の円を描く
    // Palette::`色の名前` で予め用意されている色を使える
	Circle{ Vec2{400, 300}, 20 }.draw(Palette::Salmon);
}
```

#### 変数と連携する
図形を表す型に渡す値を変数にすれば、実行時に表示する位置を変えることも出来ます。例えば、マウスカーソルの座標を取得して、それを円の中心の座標にすれば、円がマウスカーソルに付いてくることになります。

```cpp
while (System::Update())
{
    // Circle は円を表す型
    // Cursor::Pos() でマウスカーソルの座標を取得できる
    // Palette::`色の名前` で予め用意されている色を使える
	Circle{ Cursor::Pos(), 20 }.draw(Palette::Salmon);
}
```

## Siv3D Ref
- [チュートリアル 01 | Siv3D の基本｜Siv3D リファレンス v0.6.4](https://zenn.dev/reputeless/books/siv3d-documentation/viewer/tutorial-basic)
- [チュートリアル 02 | 図形を描く｜Siv3D リファレンス v0.6.4](https://zenn.dev/reputeless/books/siv3d-documentation/viewer/tutorial-shape)